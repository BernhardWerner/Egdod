  <!DOCTYPE html>
<html lang="en">
 <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Egdod test</title>
    <script type="text/javascript" src="https://cindyjs.org/dist/v0.8/Cindy.js"></script>
    <script type="text/javascript" src="https://cindyjs.org/dist/v0.8/CindyGL.js"></script>
  </head>

<body style="font-family:Palatino; margin:0; font-size:16pt">







<script id='csinit' type='text/x-cindyscript'>


func(r, s) := (
  regional(intersect, m);

  intersect = intersectRects(r, s);

  if(intersect == 0, 
    0;
  , // else //
    m = dist(r.xy, centerOfRect(r)) + dist(s.xy, centerOfRect(s));
    intersect.w * intersect.h * (m - dist(centerOfRect(r), centerOfRect(s)));
  );
);

eps = 0.001;
step = 0.001;


gradient(r, s) := (
  [
    func(rect(r.xy + [eps, 0], r.w, r.h), s) - func(r, s),
    func(rect(r.xy + [0, eps], r.w, r.h), s) - func(r, s),
    func(r, rect(s.xy + [eps, 0], s.w, s.h)) - func(r, s),
    func(r, rect(s.xy + [0, eps], s.w, s.h)) - func(r, s)
  ] / eps;
);


rectA = rect(canvasCenter - (3,5), 6, 10);
rectB = rect(mouse().xy - (5,3), 10, 6);

  
tracks = [
  setupAnimationTrack(3, 10)
];


running = false;


playanimation();
setupTime();
</script>

<script src="egdod.js"></script>




<script id='csdraw' type='text/x-cindyscript'>
fillrect(canvasRect, sapColor.background);
intersect = intersectRects(rectA, rectB);

if(intersect != 0,
  fillrect(intersect, sapColor.lightGrey);
);
  
drawrect(rectA, 4, sapColor.lightBlue);
drawrect(rectB, 4, sapColor.lightBlue);


</script>



<script id='cstick' type='text/x-cindyscript'>
delta = deltaTime();

updateAnimationCascade(tracks, delta);

println(func(rectA, rectB));
if(running,
  grad = gradient(rectA, rectB);
  updateRectPos(rectA, rectA.xy - grad_[1,2] * step);
  updateRectPos(rectB, rectB.xy - grad_[3,4] * step);
  if(func(rectA, rectB) ~= 0,
    running = false;
  );
);

</script>


<script id='csmousemove' type='text/x-cindyscript'>
if(not(running),
  updateRectPos(rectB, mouse().xy - (5,3));
);
</script>

<script id='csmousedown' type='text/x-cindyscript'>
  running = not(running);
</script>

<script id='csmousedrag' type='text/x-cindyscript'>
</script>

<script id='csmouseup' type='text/x-cindyscript'>
</script>

<!-- <script id='cskeydown' type='text/x-cindyscript'>
</script> -->


<canvas id="CSCanvas" align="left" valign="top" width="1920" height="1080" style="border:0px solid #000000;"></canvas>





<script>
  cindy = createCindy({canvasname:"CSCanvas",
    scripts:"cs*",
    images: {
    },
    use:["katex"]
  });

</script>







</body>

</html>
